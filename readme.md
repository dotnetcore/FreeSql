FreeSql ÊòØ‰∏Ä‰∏™ÂäüËÉΩÂº∫Â§ßÁöÑ .NETStandard Â∫ìÔºåÁî®‰∫éÂØπË±°ÂÖ≥Á≥ªÊò†Â∞ÑÁ®ãÂ∫è(O/RM)ÔºåÊîØÊåÅ .NETCore 2.1+ Êàñ .NETFramework 4.6.1+ÔºàQQÁæ§Ôºö4336577Ôºâ„ÄÇ

ÊçÆ‰∫ÜËß£ÔºåÁî®Êà∑‰ΩøÁî®ÂæàÂ∞ëÈóÆÈóÆÈ¢òÔºåÁºñÁ†ÅËøáÁ®ã‰∏≠ÔºåÂõ†‰∏öÂä°ÈòªÂ°ûÔºåÊÉÖÊúâÂèØÂéüÔºõÂõ†Ê°ÜÊû∂‰ΩøÁî®ÈóÆÈ¢òÈòªÂ°ûÔºåÂæó‰∏çÂÅøÂ§±„ÄÇÊàë‰ª¨ÁöÑÂè£Âè∑ÔºöÂÅö .net ÊúÄÊñπ‰æøÁöÑ ORMÔºÅÊÑøÊØè‰∏Ä‰ΩçÂºÄÂèëËÄÖÂò¥Ëßí‰∏äÊâ¨üòèÔºÅ

| Package Name |  NuGet | Downloads |
|--------------|  ------- |  ---- |
| FreeSql | [![nuget](https://img.shields.io/nuget/v/FreeSql.svg?style=flat-square)](https://www.nuget.org/packages/FreeSql) | [![stats](https://img.shields.io/nuget/dt/FreeSql.svg?style=flat-square)](https://www.nuget.org/stats/packages/FreeSql?groupby=Version) |
| [FreeSql.Repository](https://github.com/2881099/FreeSql/wiki/Repository) | [![nuget](https://img.shields.io/nuget/v/FreeSql.Repository.svg?style=flat-square)](https://www.nuget.org/packages/FreeSql.Repository) | [![stats](https://img.shields.io/nuget/dt/FreeSql.Repository.svg?style=flat-square)](https://www.nuget.org/stats/packages/FreeSql.Repository?groupby=Version) |
| [FreeSql.DbContext](https://github.com/2881099/FreeSql.DbContext) | [![nuget](https://img.shields.io/nuget/v/FreeSql.DbContext.svg?style=flat-square)](https://www.nuget.org/packages/FreeSql.DbContext) | [![stats](https://img.shields.io/nuget/dt/FreeSql.DbContext.svg?style=flat-square)](https://www.nuget.org/stats/packages/FreeSql.DbContext?groupby=Version) |
| [FreeSql.AdminLTE](https://github.com/2881099/FreeSql.AdminLTE) | [![nuget](https://img.shields.io/nuget/v/FreeSql.AdminLTE.svg?style=flat-square)](https://www.nuget.org/packages/FreeSql.AdminLTE) | [![stats](https://img.shields.io/nuget/dt/FreeSql.AdminLTE.svg?style=flat-square)](https://www.nuget.org/stats/packages/FreeSql.AdminLTE?groupby=Version) |
| [FreeSql.Connection.Extensions](https://github.com/2881099/FreeSql.Connection.Extensions) | [![nuget](https://img.shields.io/nuget/v/FreeSql.Connection.Extensions.svg?style=flat-square)](https://www.nuget.org/packages/FreeSql.Connection.Extensions) | [![stats](https://img.shields.io/nuget/dt/FreeSql.Connection.Extensions.svg?style=flat-square)](https://www.nuget.org/stats/packages/FreeSql.Connection.Extensions?groupby=Version) |

# ÁâπÊÄß

- [x] ÊîØÊåÅ CodeFirst ËøÅÁßªÔºõ
- [x] ÊîØÊåÅ DbFirst ‰ªéÊï∞ÊçÆÂ∫ìÂØºÂÖ•ÂÆû‰ΩìÁ±ªÔºåÊèê‰æõÂ§±Ë°Ä„ÄÅË¥´Ë°Ä„ÄÅÂÖÖË°Ä‰∏âÁßçÁîüÊàêÊ®°ÊùøÔºõ
- [x] Â§ßÈáèÈááÁî® ExpressionTree ÊäÄÊúØÊèêÂçáÊÄßËÉΩÔºõ
- [x] ÊîØÊåÅÊ∑±ÂÖ•ÁöÑÁ±ªÂûãÊò†Â∞ÑÔºåÊØîÂ¶ÇpgsqlÁöÑÊï∞ÁªÑÁ±ªÂûãÔºåÂ†™Áß∞Âå†ÂøÉÂà∂‰ΩúÔºõ
- [x] ÊîØÊåÅ‰∏∞ÂØåÁöÑË°®ËææÂºèÂáΩÊï∞Ôºõ
- [x] ÊîØÊåÅÂØºËà™Â±ûÊÄßÊü•ËØ¢ÔºåÂíåÂª∂Êó∂Âä†ËΩΩÔºõ
- [x] ÊîØÊåÅÂêåÊ≠•/ÂºÇÊ≠•Êï∞ÊçÆÂ∫ìÊìç‰ΩúÊñπÊ≥ïÔºåÈìæÂºèÊü•ËØ¢ÊñπÊ≥ïÔºõ
- [x] ÊîØÊåÅËØªÂÜôÂàÜÁ¶ª„ÄÅÂàÜË°®ÂàÜÂ∫ìÔºåÁßüÊà∑ËÆæËÆ°ÔºåËøáÊª§Âô®Ôºå‰πêËßÇÈîÅÔºõ
- [x] ÊîØÊåÅÂ§öÁßçÊï∞ÊçÆÂ∫ìÔºåMySql/SqlServer/PostgreSQL/Oracle/SqliteÔºõ

| | |
| - | - |
| ![image](https://user-images.githubusercontent.com/16286519/55138232-f5e19e80-516d-11e9-9144-173cc7e52845.png) | [„ÄäSelect„Äã](https://github.com/2881099/FreeSql/wiki/%e6%9f%a5%e8%af%a2) \| [„ÄäUpdate„Äã](https://github.com/2881099/FreeSql/wiki/%e4%bf%ae%e6%94%b9) \| [„ÄäInsert„Äã](https://github.com/2881099/FreeSql/wiki/%e6%b7%bb%e5%8a%a0) \| [„ÄäDelete„Äã](https://github.com/2881099/FreeSql/wiki/%e5%88%a0%e9%99%a4) |
| ![image](https://user-images.githubusercontent.com/16286519/55138241-faa65280-516d-11e9-8b27-139dea46e4df.png) | [„ÄäË°®ËææÂºèÂáΩÊï∞„Äã](https://github.com/2881099/FreeSql/wiki/%e8%a1%a8%e8%be%be%e5%bc%8f%e5%87%bd%e6%95%b0) \| [„ÄäCodeFirst„Äã](https://github.com/2881099/FreeSql/wiki/CodeFirst) \| [„ÄäDbFirst„Äã](https://github.com/2881099/FreeSql/wiki/DbFirst) |
| ![image](https://user-images.githubusercontent.com/16286519/55138263-06921480-516e-11e9-8da9-81f18a18b694.png) | [„ÄäRepository„Äã](https://github.com/2881099/FreeSql/wiki/Repository) \| [„ÄäUnitOfWork„Äã](https://github.com/2881099/FreeSql/wiki/%e5%b7%a5%e4%bd%9c%e5%8d%95%e5%85%83) \| [„ÄäËøáÊª§Âô®„Äã](https://github.com/2881099/FreeSql/wiki/%e8%bf%87%e6%bb%a4%e5%99%a8) \| [„Ää‰πêËßÇÈîÅ„Äã](https://github.com/2881099/FreeSql/wiki/%e4%bf%ae%e6%94%b9) \| [„ÄäDbContext„Äã](https://github.com/2881099/FreeSql/wiki/DbContext) |
| ![image](https://user-images.githubusercontent.com/16286519/55138284-0eea4f80-516e-11e9-8764-29264807f402.png) | [„ÄäËØªÂÜôÂàÜÁ¶ª„Äã](https://github.com/2881099/FreeSql/wiki/%e8%af%bb%e5%86%99%e5%88%86%e7%a6%bb) \| [„ÄäÂàÜÂå∫ÂàÜË°®„Äã](https://github.com/2881099/FreeSql/wiki/%e5%88%86%e5%8c%ba%e5%88%86%e8%a1%a8) \| [„ÄäÁßüÊà∑„Äã](https://github.com/2881099/FreeSql/wiki/%e7%a7%9f%e6%88%b7) \| [*Êõ¥Êñ∞Êó•Âøó*](https://github.com/2881099/FreeSql/wiki/%e6%9b%b4%e6%96%b0%e6%97%a5%e5%bf%97) |

# Quick start

> dotnet add package FreeSql

```csharp
IFreeSql fsql = new FreeSql.FreeSqlBuilder()
    .UseConnectionString(FreeSql.DataType.Sqlite, 
        @"Data Source=|DataDirectory|\document.db;Pooling=true;Max Pool Size=10")
    .UseAutoSyncStructure(true) //Ëá™Âä®ÂêåÊ≠•ÂÆû‰ΩìÁªìÊûÑÂà∞Êï∞ÊçÆÂ∫ì
    .Build();

class Song {
    [Column(IsIdentity = true)]
    public int Id { get; set; }
    public string Title { get; set; }
    public string Url { get; set; }
    public DateTime CreateTime { get; set; }

    public virtual ICollection<Tag> Tags { get; set; }
}
class Song_tag {
    public int Song_id { get; set; }
    public virtual Song Song { get; set; }

    public int Tag_id { get; set; }
    public virtual Tag Tag { get; set; }
}
class Tag {
    [Column(IsIdentity = true)]
    public int Id { get; set; }
    public string Name { get; set; }

    public int? Parent_id { get; set; }
    public virtual Tag Parent { get; set; }

    public virtual ICollection<Song> Songs { get; set; }
    public virtual ICollection<Tag> Tags { get; set; }
}
```

# Query
```csharp
//OneToOne„ÄÅManyToOne
var t0 = fsql.Select<Tag>()
    .Where(a => a.Parent.Parent.Name == "Á≤§ËØ≠")
	.Include(a => a.Tags, then => then.Where(sub => sub.Name == "xxx"))
    .ToList();

//OneToMany
var t1 = fsql.Select<Tag>()
    .Where(a => a.Tags.AsSelect()
        .Any(t => t.Parent.Id == 10))
    .ToList();

//ManyToMany
var t2 = fsql.Select<Song>()
    .Where(s => s.Tags.AsSelect()
        .Any(t => t.Name == "ÂõΩËØ≠"))
	.Include(a => a.Tags, then => then.Where(sub => sub.Name == "xxx"))
    .ToList();

//Other
var t3 = fsql.Select<Xxx>()
    .Where(a => a.IsDelete == 0)
    .WhereIf(keyword != null, a => a.UserName.Contains(keyword))
    .WhereIf(role_id > 0, a => a.RoleId == role_id)
    .Where(a => a.Nodes.AsSelect().Any(t => t.Parent.Id == t.UserId))
    .Count(out var total)
    .Page(page, size)
    .OrderByDescending(a => a.Id)
    .ToList()
```
Êõ¥Â§öÂâçÂæÄWikiÔºö[„ÄäSelect Êü•ËØ¢Êï∞ÊçÆÊñáÊ°£„Äã](https://github.com/2881099/FreeSql/wiki/%e6%9f%a5%e8%af%a2)

```csharp
var t3 = fsql.Select<Song>()
    .Where(a => new[] { 1, 2, 3 }.Contains(a.Id))
    .ToList();
```
```csharp
var t4 = fsql.Select<Song>()
    .Where(a => a.CreateTime.Date == DateTime.Now.Date)
    .ToList();
```
```csharp
var t5 = fsql.Select<Song>()
    .OrderBy(a => Guid.NewGuid())
    .Limit(1)
    .ToList();
```
Êõ¥Â§öÂâçÂæÄWikiÔºö[„ÄäË°®ËææÂºèÂáΩÊï∞„Äã](https://github.com/2881099/FreeSql/wiki/%e8%a1%a8%e8%be%be%e5%bc%8f%e5%87%bd%e6%95%b0) 

# Repository & UnitOfWork
> dotnet add package FreeSql.Repository

```csharp
using (var uow = fsql.CreateUnitOfWork()) {
    var repo1 = uow.GetRepository<Song, int>();
    var repo2 = uow.GetRepository<Tag, int>();

    await repo1.InsertAsync(new Song());
    await repo2.InsertAsync(new Tag());
    uow.Commit();
}
```

# DbContext & DbSet
> dotnet add package FreeSql.DbContext

```csharp
public class SongContext : DbContext {
    public DbSet<Song> Songs { get; set; }
    public DbSet<Tag> Tags { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder builder) {
        builder.UseFreeSql(fsql);
    }
}

using (var ctx = new SongContext()) {
    var tag = new Tag {
        Name = "testaddsublist",
        Tags = new[] {
            new Tag { Name = "sub1" },
            new Tag { Name = "sub2" },
            new Tag {
                Name = "sub3",
                Tags = new[] {
                    new Tag { Name = "sub3_01" }
                }
            }
        }
    };
    ctx.Tags.Add(tag);
    await ctx.SaveChangesAsync();
}
```

# DataFilter & Tenant

```csharp
public void ConfigureServices(IServiceCollection services) {
    services.AddSingleton<IFreeSql>(Fsql);
    services.AddFreeRepository(filter => filter
        .Apply<ISoftDelete>("SoftDelete", a => a.IsDeleted == false)
        .Apply<ITenant>("Tenant", a => a.TenantId == 1)
        ,
        this.GetType().Assembly
    );
}
```

Temporary disable:
```csharp
var repoq = fsql.GetRepository<Song, int>();

using (repo1.DataFilter.Disable("Tenant")) {
    //Tenant Invalid
}
//Tenant restore
```

# Performance

FreeSql Query & Dapper Query
```shell
Elapsed: 00:00:00.6733199; Query Entity Counts: 131072; ORM: Dapper

Elapsed: 00:00:00.4554230; Query Tuple Counts: 131072; ORM: Dapper

Elapsed: 00:00:00.6846146; Query Dynamic Counts: 131072; ORM: Dapper

Elapsed: 00:00:00.6818111; Query Entity Counts: 131072; ORM: FreeSql*

Elapsed: 00:00:00.6060042; Query Tuple Counts: 131072; ORM: FreeSql*

Elapsed: 00:00:00.4211323; Query ToList<Tuple> Counts: 131072; ORM: FreeSql*

Elapsed: 00:00:01.0236285; Query Dynamic Counts: 131072; ORM: FreeSql*
```

FreeSql ToList & Dapper Query
```shell
Elapsed: 00:00:00.6707125; ToList Entity Counts: 131072; ORM: FreeSql*

Elapsed: 00:00:00.6495301; Query Entity Counts: 131072; ORM: Dapper
```

[Test code](FreeSql.Tests.PerformanceTests/MySqlAdoTest.cs)

# Contributors

[systemhejiyong](https://github.com/systemhejiyong)
[LambertW](https://github.com/LambertW)
[mypeng1985](https://github.com/mypeng1985)
